<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title> Kelas 8 (Paperless, Click-to-Move)</title>

<link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

<style>
 body { font-family: "Poppins", sans-serif; background: linear-gradient(180deg,#dbeafe 0%, #fce7f3 100%); -webkit-font-smoothing:antialiased; }
 .card { background: white; border-radius: 14px; box-shadow: 0 10px 30px rgba(16,24,40,0.08); }
 .chip { background:#eef2ff; color:#3730a3; padding:6px 10px; border-radius:999px; font-weight:700; }
 .draggable { background:#60a5fa; color:#fff; padding:10px 12px; border-radius:12px; cursor:pointer; user-select:none; margin-bottom:8px; transition: background-color 0.15s; touch-action: manipulation; }
 .draggable:hover { background-color: #3b82f6; }
 .source { background:#eff6ff; border:2px dashed rgba(99,102,241,0.22); min-height:90px; padding:10px; border-radius:12px; }
 .target { background:#fff7ed; border:2px dashed rgba(245,158,11,0.22); min-height:90px; padding:10px; border-radius:12px; }
 .note { font-size:13px; color:#374151; }
 #warning { background:#fff7ed; border:2px solid #f59e0b; color:#92400e; font-weight:700; border-radius:10px; padding:10px; margin-bottom:12px; }
 .btn { transition: .15s; }
 .btn:active { transform: translateY(1px); }
 @media (max-width:700px) { .two-col { grid-template-columns: 1fr !important; } }
 .result-data-box { display: flex; justify-content: space-around; background: #f1f5f9; padding: 10px; border-radius: 8px; margin-bottom: 15px; }
</style>
</head>
<body class="min-h-screen flex items-center justify-center p-4">

<div id="root" class="w-full max-w-4xl">
 <div class="card p-6" id="capture-area">
  <div id="warning" class="mb-4">‚ö†Ô∏è Jangan refresh halaman selama mengerjakan kuis ‚Äî jika refresh, progres hilang. Setelah selesai juga tidak bisa mengulang pada perangkat ini.</div>

  <!-- Start Screen -->
  <div id="startScreen">
   <h1 class="text-2xl font-extrabold text-indigo-700 mb-2">üß© Ujian kelas 8</h1>
   <p class="text-gray-600 mb-4">Susun urutan langkah yang benar.</p>

   <label for="studentName" class="block text-sm font-medium text-gray-700">Nama Siswa</label>
   <input id="studentName" class="mt-2 mb-3 w-full p-3 border rounded-lg" placeholder="Tulis nama lengkap..." />

   <div class="grid grid-cols-2 gap-3 mb-4">
    <div>
     <label for="studentNis" class="block text-sm font-medium text-gray-700">Absen (NIS)</label>
     <input id="studentNis" class="mt-2 w-full p-3 border rounded-lg" placeholder="Contoh: 01" />
    </div>
    <div>
     <label for="studentClass" class="block text-sm font-medium text-gray-700">Kelas</label>
     <input id="studentClass" class="mt-2 w-full p-3 border rounded-lg" placeholder="Contoh: 7A" />
    </div>
   </div>

   <div class="flex gap-3">
    <button id="btnStart" class="btn bg-indigo-600 text-white px-4 py-2 rounded-lg font-bold">Mulai Ujian</button>
    <button id="btnPreview" class="btn bg-white border px-4 py-2 rounded-lg">Lihat Kisi-Kisi</button>
   </div>

   <p class="text-sm text-gray-500 mt-4">Mode: <b>Click-to-move</b> (Klik item di kiri ‚Üí masuk ke kanan. Klik item di kanan ‚Üí kembali ke kiri).</p>
  </div>

  <!-- Kisi-Kisi -->
  <div id="kisi" class="hidden mt-4 card p-4">
   <h3 class="font-semibold text-indigo-700 mb-2">Kisi-Kisi Materi</h3>
   <ul class="list-disc pl-5 text-gray-700">
    <li>Aktivitas harian sederhana</li>
    <li>Dunia digital & teknologi sehari-hari</li>
    <li>Kegiatan rumah tangga & luar rumah</li>
    <li>Langkah algoritmik sederhana & tipe data cerita</li>
   </ul>
  </div>

  <!-- Quiz Area -->
  <div id="quizArea" class="hidden mt-2">
   <div class="flex items-center justify-between mb-4">
    <span id="qLabel" class="chip">Soal 1 / 10</span>
    <div class="flex items-center gap-3">
     <span id="progressText" class="text-sm text-gray-600">Progres</span>
     <div class="w-40 bg-gray-200 rounded-full h-2 overflow-hidden">
      <div id="progressFill" class="bg-indigo-600 h-2 rounded-full" style="width:0%"></div>
     </div>
    </div>
   </div>

   <div class="card p-4 mb-4">
    <h2 id="qText" class="text-lg font-bold text-indigo-700 mb-4">Pertanyaan akan tampil di sini</h2>

    <div class="grid two-col grid-cols-2 gap-4">
     <div>
      <h4 class="font-medium text-gray-600 mb-2">Pilihan langkah (klik untuk pindah)</h4>
      <div id="source" class="source"></div>
     </div>

     <div>
      <h4 class="font-medium text-gray-600 mb-2">Susun urutan di sini (tarik untuk reorder)</h4>
      <div id="target" class="target"></div>
      <p class="note mt-2">Ket: klik item di kanan untuk mengembalikan ke kiri; tarik untuk mengubah urutan.</p>
     </div>
    </div>

    <div class="flex items-center justify-between mt-4">
     <div class="text-sm text-gray-600">Tarik item di kanan untuk ubah urutan atau klik untuk kembalikan.</div>
     <div class="flex gap-2">
      <button id="btnPrev" class="btn px-4 py-2 rounded-md bg-white border">Sebelumnya</button>
      <button id="btnNext" class="btn px-4 py-2 rounded-md bg-indigo-600 text-white disabled:opacity-60">Selanjutnya</button>
     </div>
    </div>
   </div>
  </div>

  <!-- Result Area -->
  <div id="resultArea" class="hidden text-center p-4">
   <h2 class="text-2xl font-bold text-indigo-700 mb-2">‚úÖ Ujian Selesai</h2>

   <div class="result-data-box">
    <div class="flex flex-col items-center">
     <span class="text-xs text-gray-500">NAMA SISWA</span>
     <span id="resultName" class="text-base font-semibold text-gray-800"></span>
    </div>
    <div class="flex flex-col items-center">
     <span class="text-xs text-gray-500">ABSEN (NIS)</span>
     <span id="resultNis" class="text-base font-semibold text-gray-800"></span>
    </div>
    <div class="flex flex-col items-center">
     <span class="text-xs text-gray-500">KELAS</span>
     <span id="resultClass" class="text-base font-semibold text-gray-800"></span>
    </div>
   </div>

   <p id="resultText" class="text-lg mb-2 font-bold"></p>
   <p id="statusText" class="text-xl font-extrabold mb-4"></p>

   <button id="btnReset" class="btn bg-red-500 text-white px-4 py-2 rounded-lg">üîÑ Reset Ujian</button>

   <div class="flex justify-center gap-3 mt-3">
    <button id="btnScreenshot" class="btn bg-green-500 text-white px-4 py-2 rounded-lg font-bold">üì∏ Ambil Screenshot Hasil</button>
    <button id="btnShareWA" class="btn bg-blue-500 text-white px-4 py-2 rounded-lg font-bold">üí¨ Kirim via WhatsApp</button>
    <button id="btnDone" class="btn bg-indigo-600 text-white px-4 py-2 rounded-lg">Selesai</button>
   </div>
  </div>

 </div>
</div>

<script>
/* =========================
   Soal
   ========================= */
const QUESTIONS = [

{
q: "**Masalah 1: Menghitung Total Konsumsi Energi Mesin Produksi (SUM).**\nDi sebuah pabrik tekstil, setiap mesin pencelupan kain mencatat konsumsi listrik per jam. Supervisor produksi ingin mengetahui total konsumsi energi harian untuk laporan efisiensi. Kamu diminta menyusun langkah Excel untuk menghitung total energi.\n\n+-------------------+----------------+\n| Mesin             | kWh per Jam    |\n+-------------------+----------------+\n|                   |                |\n|                   |                |\n+-------------------+----------------+\n\nSusun langkah teknis penggunaan SUM.",
items: [
"Masukkan rentang kWh ke dalam fungsi",
"Pilih sel untuk total energi",
"Gunakan fungsi =SUM()",
"Tekan Enter untuk menghasilkan total",
"Ketik tanda sama dengan (=)",
"Blok seluruh data konsumsi energi"
],
correct: [
"Pilih sel untuk total energi",
"Ketik tanda sama dengan (=)",
"Gunakan fungsi =SUM()",
"Masukkan rentang kWh ke dalam fungsi",
"Blok seluruh data konsumsi energi",
"Tekan Enter untuk menghasilkan total"
]
},

{
q: "**Masalah 2: Menentukan Mesin dengan Efisiensi Terburuk (MIN).**\nTim maintenance ingin mengetahui mesin dengan output terendah dalam satu shift. Data output dicatat dalam tabel berikut:\n\n+---------------+--------------+\n| Mesin         | Output (kg)  |\n+---------------+--------------+\n|               |              |\n|               |              |\n+---------------+--------------+\n\nSusun langkah untuk mendapatkan nilai minimum secara teknis.",
items: [
"Pilih sel tempat nilai minimum ditampilkan",
"Ketik (=)",
"Gunakan fungsi =MIN()",
"Masukkan rentang output",
"Blok semua nilai output",
"Tekan Enter"
],
correct: [
"Pilih sel tempat nilai minimum ditampilkan",
"Ketik (=)",
"Gunakan fungsi =MIN()",
"Masukkan rentang output",
"Blok semua nilai output",
"Tekan Enter"
]
},

{
q: "**Masalah 3: Menentukan Suhu Maksimum Laboratorium (MAX).**\nLaboratorium kimia mencatat suhu reaktor setiap jam untuk memastikan suhu tidak melebihi batas aman.\n\n+--------------+-------------+\n| Waktu        | Suhu (¬∞C)   |\n+--------------+-------------+\n|              |             |\n|              |             |\n+--------------+-------------+\n\nSusun prosedur Excel untuk mendapatkan suhu tertinggi.",
items: [
"Masukkan rentang suhu ke fungsi",
"Pilih sel hasil maksimum",
"Gunakan fungsi =MAX()",
"Blok seluruh kolom suhu",
"Ketik (=)",
"Tekan Enter"
],
correct: [
"Pilih sel hasil maksimum",
"Ketik (=)",
"Gunakan fungsi =MAX()",
"Masukkan rentang suhu ke fungsi",
"Blok seluruh kolom suhu",
"Tekan Enter"
]
},

{
q: "**Masalah 4: Menghitung Rata-Rata Tingkat Error Barcode Gudang (AVERAGE).**\nSebuah gudang logistik ingin mengetahui rata-rata tingkat error scanner barcode.\n\n+--------------------+------------------+\n| Scanner            | Error (%)        |\n+--------------------+------------------+\n|                    |                  |\n|                    |                  |\n+--------------------+------------------+\n\nSusun langkah AVERAGE pada kasus teknis ini.",
items: [
"Pilih sel untuk rata-rata error",
"Ketik (=)",
"Masukkan rentang error ke fungsi",
"Gunakan fungsi =AVERAGE()",
"Blok seluruh kolom error",
"Tekan Enter"
],
correct: [
"Pilih sel untuk rata-rata error",
"Ketik (=)",
"Gunakan fungsi =AVERAGE()",
"Masukkan rentang error ke fungsi",
"Blok seluruh kolom error",
"Tekan Enter"
]
},

{
q: "**Masalah 5: Kelayakan Produk Berdasarkan Standar Kualitas (IF).**\nQC (Quality Control) ingin menentukan apakah kadar air pada sampel produk memenuhi standar (< 12%).\n\n+------------------+---------------------+\n| Sampel Produk    | Kadar Air (%)       |\n+------------------+---------------------+\n|                  |                     |\n|                  |                     |\n+------------------+---------------------+\n\nGunakan IF untuk menampilkan 'Layak' atau 'Tidak Layak'.",
items: [
"Masukkan syarat <12",
"Pilih sel hasil kelayakan",
"Ketik (=)",
"Masukkan output 'Layak' dan 'Tidak Layak'",
"Gunakan fungsi =IF()",
"Tekan Enter"
],
correct: [
"Pilih sel hasil kelayakan",
"Ketik (=)",
"Gunakan fungsi =IF()",
"Masukkan syarat <12",
"Masukkan output 'Layak' dan 'Tidak Layak'",
"Tekan Enter"
]
},

{
q: "**Masalah 6: Menghitung Jumlah Sensor yang Memberikan Sinyal (COUNT).**\nServer IoT mencatat sinyal masuk dari berbagai sensor. Hanya sensor aktif yang memiliki nilai.\n\n+---------------+---------------+\n| Sensor        | Status Sinyal |\n+---------------+---------------+\n|               |               |\n|               |               |\n+---------------+---------------+\n\nGunakan COUNT untuk menghitung sensor aktif.",
items: [
"Ketik (=)",
"Blok seluruh kolom status",
"Gunakan fungsi =COUNT()",
"Pilih sel keluaran jumlah",
"Masukkan rentang status",
"Tekan Enter"
],
correct: [
"Pilih sel keluaran jumlah",
"Ketik (=)",
"Gunakan fungsi =COUNT()",
"Masukkan rentang status",
"Blok seluruh kolom status",
"Tekan Enter"
]
},

{
q: "**Masalah 7: Total Beban Jaringan Server (SUM).**\nDivisi IT ingin menjumlahkan beban bandwidth server dari berbagai aplikasi.\n\n+----------------+-------------+\n| Aplikasi       | Bandwidth   |\n+----------------+-------------+\n|                |             |\n|                |             |\n+----------------+-------------+\n\nGunakan SUM.",
items: [
"Ketik (=)",
"Gunakan fungsi =SUM()",
"Masukkan rentang bandwidth",
"Pilih sel total",
"Blok seluruh kolom bandwidth",
"Tekan Enter"
],
correct: [
"Pilih sel total",
"Ketik (=)",
"Gunakan fungsi =SUM()",
"Masukkan rentang bandwidth",
"Blok seluruh kolom bandwidth",
"Tekan Enter"
]
},

{
q: "**Masalah 8: Mencari Performa Sales Tertinggi (MAX).**\nPerusahaan ingin mengetahui siapa sales dengan performa tertinggi.\n\n+--------------+------------+\n| Sales        | Closing    |\n+--------------+------------+\n|              |            |\n|              |            |\n+--------------+------------+\n\nGunakan MAX secara teknis.",
items: [
"Masukkan rentang closing",
"Ketik (=)",
"Gunakan =MAX()",
"Pilih sel output",
"Blok data closing",
"Tekan Enter"
],
correct: [
"Pilih sel output",
"Ketik (=)",
"Gunakan =MAX()",
"Masukkan rentang closing",
"Blok data closing",
"Tekan Enter"
]
},

{
q: "**Masalah 9: Nilai Minimum Tegangan Listrik (MIN).**\nTeknisi panel ingin mencari tegangan paling rendah dari log monitoring.\n\n+---------------+---------------+\n| Waktu         | Tegangan (V)  |\n+---------------+---------------+\n|               |               |\n|               |               |\n+---------------+---------------+\n\nGunakan MIN.",
items: [
"Pilih sel keluaran",
"Masukkan rentang tegangan",
"Ketik (=)",
"Gunakan =MIN()",
"Blok seluruh kolom tegangan",
"Tekan Enter"
],
correct: [
"Pilih sel keluaran",
"Ketik (=)",
"Gunakan =MIN()",
"Masukkan rentang tegangan",
"Blok seluruh kolom tegangan",
"Tekan Enter"
]
},

{
q: "**Masalah 10: Rata-Rata Waktu Response Server (AVERAGE).**\nTim backend mengukur rata-rata waktu respons server.\n\n+----------------+------------------+\n| Request        | Response (ms)    |\n+----------------+------------------+\n|                |                  |\n|                |                  |\n+----------------+------------------+\n\nGunakan AVERAGE.",
items: [
"Pilih sel rata-rata",
"Gunakan =AVERAGE()",
"Ketik (=)",
"Masukkan rentang respons",
"Blok kolom respons",
"Tekan Enter"
],
correct: [
"Pilih sel rata-rata",
"Ketik (=)",
"Gunakan =AVERAGE()",
"Masukkan rentang respons",
"Blok kolom respons",
"Tekan Enter"
]
},

{
q: "**Masalah 11: Menentukan Karyawan Berhak Insentif (IF).**\nHRD memberikan insentif jika absensi ‚â• 95%.\n\n+---------------+-------------+\n| Karyawan      | Absensi %   |\n+---------------+-------------+\n|               |             |\n|               |             |\n+---------------+-------------+\n\nGunakan IF.",
items: [
"Masukkan kondisi output",
"Ketik (=)",
"Pilih sel status insentif",
"Gunakan =IF()",
"Masukkan syarat >=95%",
"Tekan Enter"
],
correct: [
"Pilih sel status insentif",
"Ketik (=)",
"Gunakan =IF()",
"Masukkan syarat >=95%",
"Masukkan kondisi output",
"Tekan Enter"
]
},

{
q: "**Masalah 12: Hitung Jumlah Data Sensor Valid (COUNT).**\nTim IoT ingin menghitung jumlah sensor yang memberikan data valid (bernilai angka).\n\n+--------------+--------------+\n| Sensor       | Data         |\n+--------------+--------------+\n|              |              |\n|              |              |\n+--------------+--------------+\n\nGunakan COUNT.",
items: [
"Pilih sel hasil",
"Ketik (=)",
"Gunakan =COUNT()",
"Masukkan rentang data",
"Blok kolom data",
"Tekan Enter"
],
correct: [
"Pilih sel hasil",
"Ketik (=)",
"Gunakan =COUNT()",
"Masukkan rentang data",
"Blok kolom data",
"Tekan Enter"
]
},

{
q: "**Masalah 13: Total Beban Kerja CPU VM (SUM).**\nAdmin server melakukan analisis beban kerja CPU dalam persentase.\n\n+------------+-----------+\n| VM         | CPU (%)   |\n+------------+-----------+\n|            |           |\n|            |           |\n+------------+-----------+\n\nGunakan SUM.",
items: [
"Ketik (=)",
"Gunakan =SUM()",
"Pilih sel total",
"Masukkan rentang CPU",
"Blok seluruh kolom CPU",
"Tekan Enter"
],
correct: [
"Pilih sel total",
"Ketik (=)",
"Gunakan =SUM()",
"Masukkan rentang CPU",
"Blok seluruh kolom CPU",
"Tekan Enter"
]
},

{
q: "**Masalah 14: Output Sensor Tertinggi (MAX).**\nSebuah drone penelitian mencatat intensitas cahaya.\n\n+----------------+--------------+\n| Waktu          | Intensitas   |\n+----------------+--------------+\n|                |              |\n|                |              |\n+----------------+--------------+\n\nGunakan MAX.",
items: [
"Masukkan rentang intensitas",
"Gunakan =MAX()",
"Ketik (=)",
"Pilih sel hasil",
"Blok data intensitas",
"Tekan Enter"
],
correct: [
"Pilih sel hasil",
"Ketik (=)",
"Gunuse =MAX()",
"Masukkan rentang intensitas",
"Blok data intensitas",
"Tekan Enter"
]
},

{
q: "**Masalah 15: Nilai Terendah Kualitas Air (MIN).**\nTim lingkungan memantau kadar pH.\n\n+--------------+--------------+\n| Titik Pantau | pH           |\n+--------------+--------------+\n|              |              |\n|              |              |\n+--------------+--------------+\n\nGunakan MIN.",
items: [
"Ketik (=)",
"Masukkan rentang pH",
"Pilih sel hasil terendah",
"Gunakan =MIN()",
"Blok kolom pH",
"Tekan Enter"
],
correct: [
"Pilih sel hasil terendah",
"Ketik (=)",
"Gunakan =MIN()",
"Masukkan rentang pH",
"Blok kolom pH",
"Tekan Enter"
]
},

{
q: "**Masalah 16: Rata-Rata Suhu Reaktor (AVERAGE).**\nInsinyur kimia ingin menghitung rata-rata suhu operasi reaktor.\n\n+--------------+-------------+\n| Jam          | Suhu (¬∞C)   |\n+--------------+-------------+\n|              |             |\n|              |             |\n+--------------+-------------+\n\nGunakan AVERAGE.",
items: [
"Masukkan rentang suhu",
"Gunakan =AVERAGE()",
"Pilih sel output",
"Blok kolom suhu",
"Ketik (=)",
"Tekan Enter"
],
correct: [
"Pilih sel output",
"Ketik (=)",
"Gunakan =AVERAGE()",
"Masukkan rentang suhu",
"Blok kolom suhu",
"Tekan Enter"
]
},

{
q: "**Masalah 17: Menentukan Status Alarm (IF).**\nSensor kebocoran gas memberi status ALARM jika kondisi ‚â• 8 ppm.\n\n+-------------+-------------+\n| Lokasi      | ppm         |\n+-------------+-------------+\n|             |             |\n|             |             |\n+-------------+-------------+\n\nGunakan IF.",
items: [
"Pilih sel status alarm",
"Ketik (=)",
"Gunakan =IF()",
"Masukkan syarat >=8",
"Masukkan output 'ALARM' dan 'AMAN'",
"Tekan Enter"
],
correct: [
"Pilih sel status alarm",
"Ketik (=)",
"Gunakan =IF()",
"Masukkan syarat >=8",
"Masukkan output 'ALARM' dan 'AMAN'",
"Tekan Enter"
]
},

{
q: "**Masalah 18: Hitung Perangkat yang Online (COUNT).**\nSebuah router mencatat perangkat dengan status IP aktif.\n\n+-------------+--------------+\n| Device      | Status       |\n+-------------+--------------+\n|             |              |\n|             |              |\n+-------------+--------------+\n\nGunakan COUNT.",
items: [
"Blok kolom status",
"Masukkan rentang status",
"Ketik (=)",
"Pilih sel hasil online",
"Gunakan =COUNT()",
"Tekan Enter"
],
correct: [
"Pilih sel hasil online",
"Ketik (=)",
"Gunakan =COUNT()",
"Masukkan rentang status",
"Blok kolom status",
"Tekan Enter"
]
},

{
q: "**Masalah 19: Total Kecepatan Download (SUM).**\nTeknisi ISP mengukur kecepatan download beberapa server edge.\n\n+------------+------------------+\n| Server     | Mbps             |\n+------------+------------------+\n|            |                  |\n|            |                  |\n+------------+------------------+\n\nGunakan SUM.",
items: [
"Ketik (=)",
"Pilih sel total",
"Gunakan =SUM()",
"Masukkan rentang Mbps",
"Blok semua nilai Mbps",
"Tekan Enter"
],
correct: [
"Pilih sel total",
"Ketik (=)",
"Gunakan =SUM()",
"Masukkan rentang Mbps",
"Blok semua nilai Mbps",
"Tekan Enter"
]
},

{
q: "**Masalah 20: Nilai Maksimum Beban Robot Industri (MAX).**\nRobot industri mencatat beban angkat per operasi.\n\n+-------------+-------------+\n| Operasi     | Beban (kg)  |\n+-------------+-------------+\n|             |             |\n|             |             |\n+-------------+-------------+\n\nGunakan MAX.",
items: [
"Gunakan =MAX()",
"Ketik (=)",
"Pilih sel hasil maksimum",
"Masukkan rentang beban",
"Blok kolom beban",
"Tekan Enter"
],
correct: [
"Pilih sel hasil maksimum",
"Ketik (=)",
"Gunakan =MAX()",
"Masukkan rentang beban",
"Blok kolom beban",
"Tekan Enter"
]
}

];
/* =========================
   App logic
   ========================= */
const KKM = 72;
const totalQ = QUESTIONS.length;
let current = 0;
let answers = Array(totalQ).fill(null);
let studentName='', studentNis='', studentClass='';
const WA_NUMBER = '6285738176630'; // ganti sesuai tujuan

// DOM
const D = id => document.getElementById(id);
const $ = {
 startScreen: D('startScreen'), quizArea: D('quizArea'), kisi: D('kisi'), resultArea: D('resultArea'),
 resultText: D('resultText'), statusText: D('statusText'),
 studentNameInput: D('studentName'), studentNisInput: D('studentNis'), studentClassInput: D('studentClass'),
 resultName: D('resultName'), resultNis: D('resultNis'), resultClass: D('resultClass'),
 btnStart: D('btnStart'), btnPreview: D('btnPreview'), btnScreenshot: D('btnScreenshot'),
 btnShareWA: D('btnShareWA'), btnDone: D('btnDone'), warningBar: D('warning'),
 qLabel: D('qLabel'), qText: D('qText'), sourceEl: D('source'), targetEl: D('target'),
 btnPrev: D('btnPrev'), btnNext: D('btnNext'), progressFill: D('progressFill'), progressText: D('progressText')
};

// Prevent refresh if not finished
window.addEventListener('beforeunload', e=>{
 if(!localStorage.getItem('lifeQuizTaken')){
  e.preventDefault(); e.returnValue = "‚ö†Ô∏è Jangan refresh halaman ini! Jawaban/hasil bisa hilang.";
 }
});

// ======= Reset with confirmation =======
D('btnReset').addEventListener('click', () => {
  if(confirm("‚ö†Ô∏è Yakin ingin reset kuis? Semua jawaban sebelumnya akan hilang.")){
    localStorage.removeItem('lifeQuizTaken');
    localStorage.removeItem('lifeQuizResult');
    location.reload();
  }
});

// ======= If already taken, show result =======
if(localStorage.getItem('lifeQuizTaken')){
  const stored = JSON.parse(localStorage.getItem('lifeQuizResult')||'{}');
  displayResultScreen(stored);
}

// Toggle kisi
$.btnPreview.addEventListener('click', ()=>$.kisi.classList.toggle('hidden'));

// Start quiz
$.btnStart.addEventListener('click', ()=>{
 studentName = $.studentNameInput.value.trim();
 studentNis = $.studentNisInput.value.trim();
 studentClass = $.studentClassInput.value.trim();
 if(!studentName || !studentNis || !studentClass) return alert('Nama, Absen, dan Kelas harus diisi.');
 if(localStorage.getItem('lifeQuizTaken')) return alert('‚ö†Ô∏è Ujian sudah selesai di perangkat ini.');

 $.startScreen.classList.add('hidden');
 $.quizArea.classList.remove('hidden');
 renderQuestion(current);
});

// Render question
function renderQuestion(idx){
 const q = QUESTIONS[idx];
 $.qLabel.textContent = `Soal ${idx+1} / ${totalQ}`;
 $.qText.innerHTML = q.q;

 // reset source & target
 $.sourceEl.innerHTML = '';
 $.targetEl.innerHTML = '';

 // source items
 q.items.forEach(item=>{
  const div = document.createElement('div');
  div.textContent = item;
  div.className = 'draggable';
  div.onclick = ()=>moveToTarget(div);
  $.sourceEl.appendChild(div);
 });

 // restore previous answer if ada
 if(answers[idx]){
  answers[idx].forEach(item=>{
   const div = document.createElement('div');
   div.textContent = item;
   div.className = 'draggable';
   div.onclick = ()=>moveToSource(div);
   $.targetEl.appendChild(div);
  });
 }

 // Enable drag on target
 new Sortable($.targetEl, {animation:150, onEnd:()=>updateAnswer()});

 // Disable prev/next
 $.btnPrev.disabled = idx===0;
 $.btnNext.textContent = idx===totalQ-1?'Selesai':'Selanjutnya';
}

// Move item left‚Üíright
function moveToTarget(el){
  $.targetEl.appendChild(el);
  el.onclick = ()=>moveToSource(el);
  updateAnswer();
}
// Move item right‚Üíleft
function moveToSource(el){
  $.sourceEl.appendChild(el);
  el.onclick = ()=>moveToTarget(el);
  updateAnswer();
}
// Save current answer
function updateAnswer(){
 answers[current] = Array.from($.targetEl.children).map(d=>d.textContent);
 const perc = Math.round((current/totalQ)*100);
 $.progressFill.style.width = perc+'%';
 $.progressText.textContent = `Progres ${perc}%`;
}

// Prev/Next
$.btnPrev.addEventListener('click', ()=>{
 if(current>0){ current--; renderQuestion(current); }
});
$.btnNext.addEventListener('click', ()=>{
  updateAnswer();
  if(current<totalQ-1){ current++; renderQuestion(current); }
  else finishQuiz();
});

// Finish
function finishQuiz(){
 updateAnswer();
 let correctCount = 0;
 for(let i=0;i<totalQ;i++){
   if(JSON.stringify(answers[i]||[])===JSON.stringify(QUESTIONS[i].correct)) correctCount++;
 }
 const percent = Math.round(correctCount/totalQ*100);
 const status = percent>=KKM?'LULUS':'REMEDIAL';
 const data = {
   name: studentName, nis: studentNis, class: studentClass,
   score: percent, correct: correctCount, total: totalQ, status
 };
 localStorage.setItem('lifeQuizTaken','true');
 localStorage.setItem('lifeQuizResult', JSON.stringify(data));
 displayResultScreen(data);
}

// Show result
function displayResultScreen(data){
 $.startScreen.classList.add('hidden');
 $.quizArea.classList.add('hidden');
 $.resultArea.classList.remove('hidden');

 $.resultName.textContent = data.name;
 $.resultNis.textContent = data.nis;
 $.resultClass.textContent = data.class;
 $.resultText.textContent = `Nilai kamu: ${data.score} (Benar ${data.correct} / ${data.total})`;
 $.statusText.textContent = `${data.status} ‚Ä¢ KKM = ${KKM}`;
 $.warningBar.textContent = data.status==='LULUS'
   ?"‚úÖ Kuis selesai. Hasil tersimpan di perangkat ini."
   :"‚ö†Ô∏è Kuis sudah selesai di perangkat ini ‚Äî tidak bisa diulang.";

 $.warningBar.style.background = data.status==='LULUS'?"#dcfce7":"#fff7ed";
 $.warningBar.style.borderColor = data.status==='LULUS'?"#22c55e":"#f59e0b";
 $.warningBar.style.color = data.status==='LULUS'?"#166534":"#92400e";
}

// Screenshot
$.btnScreenshot.addEventListener('click', ()=>{
 html2canvas(D('capture-area')).then(canvas=>{
   const link = document.createElement('a');
   link.href = canvas.toDataURL('image/png');
   link.download = 'hasil-kuis.png';
   link.click();
 });
});

// Share WA
$.btnShareWA.addEventListener('click', ()=>{
 const data = JSON.parse(localStorage.getItem('lifeQuizResult')||'{}');
 const msg = `Halo! Berikut hasil kuis saya:\nNama: ${data.name}\nAbsen: ${data.nis}\nKelas: ${data.class}\nNilai: ${data.score}\nStatus: ${data.status}`;
 window.open(`https://wa.me/${WA_NUMBER}?text=${encodeURIComponent(msg)}`,'_blank');
});

// Done button
$.btnDone.addEventListener('click', ()=>alert("Terima kasih! Hasil tersimpan di perangkat ini."));
</script>

</body>
</html>
