<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title> Kelas 8 (Paperless, Click-to-Move)</title>

<link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

<style>
 body { font-family: "Poppins", sans-serif; background: linear-gradient(180deg,#dbeafe 0%, #fce7f3 100%); -webkit-font-smoothing:antialiased; }
 .card { background: white; border-radius: 14px; box-shadow: 0 10px 30px rgba(16,24,40,0.08); }
 .chip { background:#eef2ff; color:#3730a3; padding:6px 10px; border-radius:999px; font-weight:700; }
 .draggable { background:#60a5fa; color:#fff; padding:10px 12px; border-radius:12px; cursor:pointer; user-select:none; margin-bottom:8px; transition: background-color 0.15s; touch-action: manipulation; }
 .draggable:hover { background-color: #3b82f6; }
 .source { background:#eff6ff; border:2px dashed rgba(99,102,241,0.22); min-height:90px; padding:10px; border-radius:12px; }
 .target { background:#fff7ed; border:2px dashed rgba(245,158,11,0.22); min-height:90px; padding:10px; border-radius:12px; }
 .note { font-size:13px; color:#374151; }
 #warning { background:#fff7ed; border:2px solid #f59e0b; color:#92400e; font-weight:700; border-radius:10px; padding:10px; margin-bottom:12px; }
 .btn { transition: .15s; }
 .btn:active { transform: translateY(1px); }
 @media (max-width:700px) { .two-col { grid-template-columns: 1fr !important; } }
 .result-data-box { display: flex; justify-content: space-around; background: #f1f5f9; padding: 10px; border-radius: 8px; margin-bottom: 15px; }
</style>
</head>
<body class="min-h-screen flex items-center justify-center p-4">

<div id="root" class="w-full max-w-4xl">
 <div class="card p-6" id="capture-area">
  <div id="warning" class="mb-4">‚ö†Ô∏è Jangan refresh halaman selama mengerjakan kuis ‚Äî jika refresh, progres hilang. Setelah selesai juga tidak bisa mengulang pada perangkat ini.</div>

  <!-- Start Screen -->
  <div id="startScreen">
   <h1 class="text-2xl font-extrabold text-indigo-700 mb-2">üß© Ujian kelas 8</h1>
   <p class="text-gray-600 mb-4">Susun urutan langkah yang benar.</p>

   <label for="studentName" class="block text-sm font-medium text-gray-700">Nama Siswa</label>
   <input id="studentName" class="mt-2 mb-3 w-full p-3 border rounded-lg" placeholder="Tulis nama lengkap..." />

   <div class="grid grid-cols-2 gap-3 mb-4">
    <div>
     <label for="studentNis" class="block text-sm font-medium text-gray-700">Absen (NIS)</label>
     <input id="studentNis" class="mt-2 w-full p-3 border rounded-lg" placeholder="Contoh: 01" />
    </div>
    <div>
     <label for="studentClass" class="block text-sm font-medium text-gray-700">Kelas</label>
     <input id="studentClass" class="mt-2 w-full p-3 border rounded-lg" placeholder="Contoh: 7A" />
    </div>
   </div>

   <div class="flex gap-3">
    <button id="btnStart" class="btn bg-indigo-600 text-white px-4 py-2 rounded-lg font-bold">Mulai Ujian</button>
    <button id="btnPreview" class="btn bg-white border px-4 py-2 rounded-lg">Lihat Kisi-Kisi</button>
   </div>

   <p class="text-sm text-gray-500 mt-4">Mode: <b>Click-to-move</b> (Klik item di kiri ‚Üí masuk ke kanan. Klik item di kanan ‚Üí kembali ke kiri).</p>
  </div>

  <!-- Kisi-Kisi -->
  <div id="kisi" class="hidden mt-4 card p-4">
   <h3 class="font-semibold text-indigo-700 mb-2">Kisi-Kisi Materi</h3>
   <ul class="list-disc pl-5 text-gray-700">
    <li>Aktivitas harian sederhana</li>
    <li>Dunia digital & teknologi sehari-hari</li>
    <li>Kegiatan rumah tangga & luar rumah</li>
    <li>Langkah algoritmik sederhana & tipe data cerita</li>
   </ul>
  </div>

  <!-- Quiz Area -->
  <div id="quizArea" class="hidden mt-2">
   <div class="flex items-center justify-between mb-4">
    <span id="qLabel" class="chip">Soal 1 / 10</span>
    <div class="flex items-center gap-3">
     <span id="progressText" class="text-sm text-gray-600">Progres</span>
     <div class="w-40 bg-gray-200 rounded-full h-2 overflow-hidden">
      <div id="progressFill" class="bg-indigo-600 h-2 rounded-full" style="width:0%"></div>
     </div>
    </div>
   </div>

   <div class="card p-4 mb-4">
    <h2 id="qText" class="text-lg font-bold text-indigo-700 mb-4">Pertanyaan akan tampil di sini</h2>

    <div class="grid two-col grid-cols-2 gap-4">
     <div>
      <h4 class="font-medium text-gray-600 mb-2">Pilihan langkah (klik untuk pindah)</h4>
      <div id="source" class="source"></div>
     </div>

     <div>
      <h4 class="font-medium text-gray-600 mb-2">Susun urutan di sini (tarik untuk reorder)</h4>
      <div id="target" class="target"></div>
      <p class="note mt-2">Ket: klik item di kanan untuk mengembalikan ke kiri; tarik untuk mengubah urutan.</p>
     </div>
    </div>

    <div class="flex items-center justify-between mt-4">
     <div class="text-sm text-gray-600">Tarik item di kanan untuk ubah urutan atau klik untuk kembalikan.</div>
     <div class="flex gap-2">
      <button id="btnPrev" class="btn px-4 py-2 rounded-md bg-white border">Sebelumnya</button>
      <button id="btnNext" class="btn px-4 py-2 rounded-md bg-indigo-600 text-white disabled:opacity-60">Selanjutnya</button>
     </div>
    </div>
   </div>
  </div>

  <!-- Result Area -->
  <div id="resultArea" class="hidden text-center p-4">
   <h2 class="text-2xl font-bold text-indigo-700 mb-2">‚úÖ Ujian Selesai</h2>

   <div class="result-data-box">
    <div class="flex flex-col items-center">
     <span class="text-xs text-gray-500">NAMA SISWA</span>
     <span id="resultName" class="text-base font-semibold text-gray-800"></span>
    </div>
    <div class="flex flex-col items-center">
     <span class="text-xs text-gray-500">ABSEN (NIS)</span>
     <span id="resultNis" class="text-base font-semibold text-gray-800"></span>
    </div>
    <div class="flex flex-col items-center">
     <span class="text-xs text-gray-500">KELAS</span>
     <span id="resultClass" class="text-base font-semibold text-gray-800"></span>
    </div>
   </div>

   <p id="resultText" class="text-lg mb-2 font-bold"></p>
   <p id="statusText" class="text-xl font-extrabold mb-4"></p>

   <button id="btnReset" class="btn bg-red-500 text-white px-4 py-2 rounded-lg">üîÑ Reset Ujian</button>

   <div class="flex justify-center gap-3 mt-3">
    <button id="btnScreenshot" class="btn bg-green-500 text-white px-4 py-2 rounded-lg font-bold">üì∏ Ambil Screenshot Hasil</button>
    <button id="btnShareWA" class="btn bg-blue-500 text-white px-4 py-2 rounded-lg font-bold">üí¨ Kirim via WhatsApp</button>
    <button id="btnDone" class="btn bg-indigo-600 text-white px-4 py-2 rounded-lg">Selesai</button>
   </div>
  </div>

 </div>
</div>

<script>
/* =========================
   Soal
   ========================= */
const QUESTIONS = [

{
q: "**Masalah 1: Menghitung Total Donat Terjual (SUM).**\nToko Donat Pak Jaya mencatat penjualan harian dalam tabel berikut:\n\n\
+------------+--------+\n\
| Rasa       | Jumlah |\n\
+------------+--------+\n\
| Coklat     |   25   |\n\
| Stroberi   |   18   |\n\
| Keju       |   30   |\n\
+------------+--------+\n\
Hitung total seluruh donat yang terjual.",
items:[
"Klik sel tempat total akan ditampilkan",
"Ketik rumus =SUM(B2:B4)",
"Tekan Enter"
],
correct:[
"Klik sel tempat total akan ditampilkan",
"Ketik rumus =SUM(B2:B4)",
"Tekan Enter"
]
},

{
q: "**Masalah 2: Mencari Nilai Ujian Tertinggi (MAX).**\nPak Guru ingin mengetahui nilai tertinggi dari ujian matematika.\n\n\
+---------+-------+\n\
| Nama    | Nilai |\n\
+---------+-------+\n\
| Andi    |  78   |\n\
| Budi    |  90   |\n\
| Siti    |  85   |\n\
+---------+-------+\n\
Gunakan fungsi MAX.",
items:[
"Klik sel hasil",
"Ketik =MAX(B2:B4)",
"Tekan Enter"
],
correct:[
"Klik sel hasil",
"Ketik =MAX(B2:B4)",
"Tekan Enter"
]
},

{
q: "**Masalah 3: Menentukan Nilai Terendah (MIN).**\nBu Rani ingin mencari nilai yang paling kecil dari daftar nilai berikut:\n\n\
+---------+-------+\n\
| Nama    | Nilai |\n\
+---------+-------+\n\
| Riko    |  80   |\n\
| Lala    |  95   |\n\
| Sari    |  88   |\n\
+---------+-------+\n\
Gunakan MIN untuk menemukan nilai terendah.",
items:[
"Klik sel kosong",
"Ketik =MIN(B2:B4)",
"Tekan Enter"
],
correct:[
"Klik sel kosong",
"Ketik =MIN(B2:B4)",
"Tekan Enter"
]
},

{
q: "**Masalah 4: Rata-Rata Nilai Tugas (AVERAGE).**\nKelas 8A mencatat nilai tugas sebagai berikut:\n\n\
+---------+-------+\n\
| Nama    | Nilai |\n\
+---------+-------+\n\
| Tono    |  70   |\n\
| Rio     |  85   |\n\
| Rani    |  90   |\n\
+---------+-------+\n\
Hitung nilai rata-rata.",
items:[
"Klik sel hasil",
"Ketik =AVERAGE(B2:B4)",
"Tekan Enter"
],
correct:[
"Klik sel hasil",
"Ketik =AVERAGE(B2:B4)",
"Tekan Enter"
]
},

{
q: "**Masalah 5: Menghitung Siswa yang Lulus (COUNTIF).**\nKriteria kelulusan: nilai > 70.\n\n\
+---------+-------+\n\
| Nama    | Nilai |\n\
+---------+-------+\n\
| Ani     |  78   |\n\
| Beni    |  60   |\n\
| Wati    |  82   |\n\
+---------+-------+\n\
Hitung jumlah siswa yang lulus.",
items:[
"Klik sel tujuan",
"Ketik =COUNTIF(B2:B4,\">70\")",
"Tekan Enter"
],
correct:[
"Klik sel tujuan",
"Ketik =COUNTIF(B2:B4,\">70\")",
"Tekan Enter"
]
},

{
q: "**Masalah 6: Menentukan Status Lulus (IF).**\nNilai Dimas adalah 75. Standar kelulusan: minimal 70.\nGunakan IF untuk menentukan status.",
items:[
"Klik sel hasil",
"Ketik =IF(75>=70,\"Lulus\",\"Tidak Lulus\")",
"Tekan Enter"
],
correct:[
"Klik sel hasil",
"Ketik =IF(75>=70,\"Lulus\",\"Tidak Lulus\")",
"Tekan Enter"
]
},

{
q: "**Masalah 7: Menjumlahkan Berat Buah (SUM).**\nToko buah mencatat data berikut:\n\n\
+---------+--------+\n\
| Buah    | Kg     |\n\
+---------+--------+\n\
| Apel    |   5    |\n\
| Mangga  |   7    |\n\
| Jeruk   |   4    |\n\
+---------+--------+\n\
Hitung total berat semua buah.",
items:[
"Klik sel hasil",
"Ketik =SUM(B2:B4)",
"Tekan Enter"
],
correct:[
"Klik sel hasil",
"Ketik =SUM(B2:B4)",
"Tekan Enter"
]
},

{
q: "**Masalah 8: Suhu Tertinggi Mingguan (MAX).**\n\n\
+-----------+-------+\n\
| Hari      | Suhu  |\n\
+-----------+-------+\n\
| Senin     |  30   |\n\
| Selasa    |  32   |\n\
| Rabu      |  29   |\n\
+-----------+-------+\n\
Gunakan MAX untuk menemukan suhu tertinggi.",
items:[
"Klik sel kosong",
"Ketik =MAX(B2:B4)",
"Tekan Enter"
],
correct:[
"Klik sel kosong",
"Ketik =MAX(B2:B4)",
"Tekan Enter"
]
},

{
q: "**Masalah 9: Diskon Belanja (IF).**\nJika belanja > 100.000 mendapatkan diskon. Total belanja Sinta: 120.000.",
items:[
"Klik sel hasil",
"Ketik =IF(120000>100000,\"Diskon\",\"Tidak\")",
"Tekan Enter"
],
correct:[
"Klik sel hasil",
"Ketik =IF(120000>100000,\"Diskon\",\"Tidak\")",
"Tekan Enter"
]
},

{
q: "**Masalah 10: Rata-Rata Tinggi Badan (AVERAGE).**\n\n\
+---------+-------+\n\
| Nama    | TB    |\n\
+---------+-------+\n\
| Fina    | 150   |\n\
| Riko    | 160   |\n\
| Tesa    | 155   |\n\
+---------+-------+\n\
Hitung rata-rata tinggi badan.",
items:[
"Klik sel tujuan",
"Ketik =AVERAGE(B2:B4)",
"Tekan Enter"
],
correct:[
"Klik sel tujuan",
"Ketik =AVERAGE(B2:B4)",
"Tekan Enter"
]
},

{
q: "**Masalah 11: Menghitung Jumlah Data (COUNT).**\n\n\
+-------------+--------+\n\
| Barang      | Stok   |\n\
+-------------+--------+\n\
| Sabun       |  10    |\n\
| Sampo       |  15    |\n\
| Pasta Gigi  |   8    |\n\
+-------------+--------+\n\
Hitung jumlah baris data stok.",
items:[
"Klik sel hasil",
"Ketik =COUNT(B2:B4)",
"Tekan Enter"
],
correct:[
"Klik sel hasil",
"Ketik =COUNT(B2:B4)",
"Tekan Enter"
]
},

{
q: "**Masalah 12: Total Biaya Harian (SUM).**\n\n\
+-------------+----------+\n\
| Kebutuhan   | Biaya    |\n\
+-------------+----------+\n\
| Transport   | 20000    |\n\
| Makan       | 25000    |\n\
| Jajan       | 15000    |\n\
+-------------+----------+\n\
Hitung total pengeluaran.",
items:[
"Klik sel kosong",
"Ketik =SUM(B2:B4)",
"Tekan Enter"
],
correct:[
"Klik sel kosong",
"Ketik =SUM(B2:B4)",
"Tekan Enter"
]
},

{
q: "**Masalah 13: Nilai Minimum Kelas (MIN).**\n\n\
+---------+-------+\n\
| Siswa   | Nilai |\n\
+---------+-------+\n\
| Joko    |  88   |\n\
| Putri   |  92   |\n\
| Wawan   |  75   |\n\
+---------+-------+\n\
Cari nilai terendah.",
items:[
"Klik sel hasil",
"Ketik =MIN(B2:B4)",
"Tekan Enter"
],
correct:[
"Klik sel hasil",
"Ketik =MIN(B2:B4)",
"Tekan Enter"
]
},

{
q: "**Masalah 14: Menentukan Bonus Kehadiran (IF).**\nKaryawan mendapat bonus jika hadir lebih dari 20 hari.\nKehadiran Ria: 22.",
items:[
"Klik sel hasil",
"Ketik =IF(22>20,\"Bonus\",\"Tidak\")",
"Tekan Enter"
],
correct:[
"Klik sel hasil",
"Ketik =IF(22>20,\"Bonus\",\"Tidak\")",
"Tekan Enter"
]
},

{
q: "**Masalah 15: Rata-Rata Uang Saku Mingguan (AVERAGE).**\n\n\
+---------+--------+\n\
| Hari    | Uang   |\n\
+---------+--------+\n\
| Senin   | 15000  |\n\
| Selasa  | 20000  |\n\
| Rabu    | 10000  |\n\
+---------+--------+\n\
Hitung rata-rata.",
items:[
"Klik sel hasil",
"Ketik =AVERAGE(B2:B4)",
"Tekan Enter"
],
correct:[
"Klik sel hasil",
"Ketik =AVERAGE(B2:B4)",
"Tekan Enter"
]
},

{
q: "**Masalah 16: Total Nilai Tugas (SUM).**\n\n\
+---------+-------+\n\
| Tugas   | Nilai |\n\
+---------+-------+\n\
| Tugas 1 |  80   |\n\
| Tugas 2 |  90   |\n\
| Tugas 3 |  85   |\n\
+---------+-------+\n\
Hitung total nilai.",
items:[
"Klik sel tujuan",
"Ketik =SUM(B2:B4)",
"Tekan Enter"
],
correct:[
"Klik sel tujuan",
"Ketik =SUM(B2:B4)",
"Tekan Enter"
]
},

{
q: "**Masalah 17: Nilai Maksimum (MAX).**\n\n\
+---------+-------+\n\
| Nama    | Nilai |\n\
+---------+-------+\n\
| Nani    |  65   |\n\
| Rara    |  88   |\n\
| Mika    |  90   |\n\
+---------+-------+\n\
Gunakan MAX untuk cari nilai tertinggi.",
items:[
"Klik sel hasil",
"Ketik =MAX(B2:B4)",
"Tekan Enter"
],
correct:[
"Klik sel hasil",
"Ketik =MAX(B2:B4)",
"Tekan Enter"
]
},

{
q: "**Masalah 18: Hitung Nilai ‚â• 80 (COUNTIF).**\n\n\
+---------+-------+\n\
| Nama    | Nilai |\n\
+---------+-------+\n\
| Sasa    |  82   |\n\
| Fina    |  70   |\n\
| Dodi    |  90   |\n\
+---------+-------+\n\
Hitung siswa dengan nilai ‚â• 80.",
items:[
"Klik sel kosong",
"Ketik =COUNTIF(B2:B4,\">=80\")",
"Tekan Enter"
],
correct:[
"Klik sel kosong",
"Ketik =COUNTIF(B2:B4,\">=80\")",
"Tekan Enter"
]
},

{
q: "**Masalah 19: Status Stok (IF).**\nJika stok < 5 maka 'Habis'. Stok apel: 3.",
items:[
"Klik sel hasil",
"Ketik =IF(3<5,\"Habis\",\"Tersedia\")",
"Tekan Enter"
],
correct:[
"Klik sel hasil",
"Ketik =IF(3<5,\"Habis\",\"Tersedia\")",
"Tekan Enter"
]
},

{
q: "**Masalah 20: Total Perolehan Nilai (SUM).**\n\n\
+---------+-------+\n\
| Tugas   | Nilai |\n\
+---------+-------+\n\
| Quiz    |  85   |\n\
| UTS     |  90   |\n\
| UAS     |  88   |\n\
+---------+-------+\n\
Gunakan SUM untuk menjumlahkan seluruh nilai.",
items:[
"Klik sel tujuan",
"Ketik =SUM(B2:B4)",
"Tekan Enter"
],
correct:[
"Klik sel tujuan",
"Ketik =SUM(B2:B4)",
"Tekan Enter"
]
}

];

/* =========================
   App logic
   ========================= */
const KKM = 72;
const totalQ = QUESTIONS.length;
let current = 0;
let answers = Array(totalQ).fill(null);
let studentName='', studentNis='', studentClass='';
const WA_NUMBER = '6285738176630'; // ganti sesuai tujuan

// DOM
const D = id => document.getElementById(id);
const $ = {
 startScreen: D('startScreen'), quizArea: D('quizArea'), kisi: D('kisi'), resultArea: D('resultArea'),
 resultText: D('resultText'), statusText: D('statusText'),
 studentNameInput: D('studentName'), studentNisInput: D('studentNis'), studentClassInput: D('studentClass'),
 resultName: D('resultName'), resultNis: D('resultNis'), resultClass: D('resultClass'),
 btnStart: D('btnStart'), btnPreview: D('btnPreview'), btnScreenshot: D('btnScreenshot'),
 btnShareWA: D('btnShareWA'), btnDone: D('btnDone'), warningBar: D('warning'),
 qLabel: D('qLabel'), qText: D('qText'), sourceEl: D('source'), targetEl: D('target'),
 btnPrev: D('btnPrev'), btnNext: D('btnNext'), progressFill: D('progressFill'), progressText: D('progressText')
};

// Prevent refresh if not finished
window.addEventListener('beforeunload', e=>{
 if(!localStorage.getItem('lifeQuizTaken')){
  e.preventDefault(); e.returnValue = "‚ö†Ô∏è Jangan refresh halaman ini! Jawaban/hasil bisa hilang.";
 }
});

// ======= Reset with confirmation =======
D('btnReset').addEventListener('click', () => {
  if(confirm("‚ö†Ô∏è Yakin ingin reset kuis? Semua jawaban sebelumnya akan hilang.")){
    localStorage.removeItem('lifeQuizTaken');
    localStorage.removeItem('lifeQuizResult');
    location.reload();
  }
});

// ======= If already taken, show result =======
if(localStorage.getItem('lifeQuizTaken')){
  const stored = JSON.parse(localStorage.getItem('lifeQuizResult')||'{}');
  displayResultScreen(stored);
}

// Toggle kisi
$.btnPreview.addEventListener('click', ()=>$.kisi.classList.toggle('hidden'));

// Start quiz
$.btnStart.addEventListener('click', ()=>{
 studentName = $.studentNameInput.value.trim();
 studentNis = $.studentNisInput.value.trim();
 studentClass = $.studentClassInput.value.trim();
 if(!studentName || !studentNis || !studentClass) return alert('Nama, Absen, dan Kelas harus diisi.');
 if(localStorage.getItem('lifeQuizTaken')) return alert('‚ö†Ô∏è Ujian sudah selesai di perangkat ini.');

 $.startScreen.classList.add('hidden');
 $.quizArea.classList.remove('hidden');
 renderQuestion(current);
});

// Render question
function renderQuestion(idx){
 const q = QUESTIONS[idx];
 $.qLabel.textContent = `Soal ${idx+1} / ${totalQ}`;
 $.qText.innerHTML = q.q;

 // reset source & target
 $.sourceEl.innerHTML = '';
 $.targetEl.innerHTML = '';

 // source items
 q.items.forEach(item=>{
  const div = document.createElement('div');
  div.textContent = item;
  div.className = 'draggable';
  div.onclick = ()=>moveToTarget(div);
  $.sourceEl.appendChild(div);
 });

 // restore previous answer if ada
 if(answers[idx]){
  answers[idx].forEach(item=>{
   const div = document.createElement('div');
   div.textContent = item;
   div.className = 'draggable';
   div.onclick = ()=>moveToSource(div);
   $.targetEl.appendChild(div);
  });
 }

 // Enable drag on target
 new Sortable($.targetEl, {animation:150, onEnd:()=>updateAnswer()});

 // Disable prev/next
 $.btnPrev.disabled = idx===0;
 $.btnNext.textContent = idx===totalQ-1?'Selesai':'Selanjutnya';
}

// Move item left‚Üíright
function moveToTarget(el){
  $.targetEl.appendChild(el);
  el.onclick = ()=>moveToSource(el);
  updateAnswer();
}
// Move item right‚Üíleft
function moveToSource(el){
  $.sourceEl.appendChild(el);
  el.onclick = ()=>moveToTarget(el);
  updateAnswer();
}
// Save current answer
function updateAnswer(){
 answers[current] = Array.from($.targetEl.children).map(d=>d.textContent);
 const perc = Math.round((current/totalQ)*100);
 $.progressFill.style.width = perc+'%';
 $.progressText.textContent = `Progres ${perc}%`;
}

// Prev/Next
$.btnPrev.addEventListener('click', ()=>{
 if(current>0){ current--; renderQuestion(current); }
});
$.btnNext.addEventListener('click', ()=>{
  updateAnswer();
  if(current<totalQ-1){ current++; renderQuestion(current); }
  else finishQuiz();
});

// Finish
function finishQuiz(){
 updateAnswer();
 let correctCount = 0;
 for(let i=0;i<totalQ;i++){
   if(JSON.stringify(answers[i]||[])===JSON.stringify(QUESTIONS[i].correct)) correctCount++;
 }
 const percent = Math.round(correctCount/totalQ*100);
 const status = percent>=KKM?'LULUS':'REMEDIAL';
 const data = {
   name: studentName, nis: studentNis, class: studentClass,
   score: percent, correct: correctCount, total: totalQ, status
 };
 localStorage.setItem('lifeQuizTaken','true');
 localStorage.setItem('lifeQuizResult', JSON.stringify(data));
 displayResultScreen(data);
}

// Show result
function displayResultScreen(data){
 $.startScreen.classList.add('hidden');
 $.quizArea.classList.add('hidden');
 $.resultArea.classList.remove('hidden');

 $.resultName.textContent = data.name;
 $.resultNis.textContent = data.nis;
 $.resultClass.textContent = data.class;
 $.resultText.textContent = `Nilai kamu: ${data.score} (Benar ${data.correct} / ${data.total})`;
 $.statusText.textContent = `${data.status} ‚Ä¢ KKM = ${KKM}`;
 $.warningBar.textContent = data.status==='LULUS'
   ?"‚úÖ Kuis selesai. Hasil tersimpan di perangkat ini."
   :"‚ö†Ô∏è Kuis sudah selesai di perangkat ini ‚Äî tidak bisa diulang.";

 $.warningBar.style.background = data.status==='LULUS'?"#dcfce7":"#fff7ed";
 $.warningBar.style.borderColor = data.status==='LULUS'?"#22c55e":"#f59e0b";
 $.warningBar.style.color = data.status==='LULUS'?"#166534":"#92400e";
}

// Screenshot
$.btnScreenshot.addEventListener('click', ()=>{
 html2canvas(D('capture-area')).then(canvas=>{
   const link = document.createElement('a');
   link.href = canvas.toDataURL('image/png');
   link.download = 'hasil-kuis.png';
   link.click();
 });
});

// Share WA
$.btnShareWA.addEventListener('click', ()=>{
 const data = JSON.parse(localStorage.getItem('lifeQuizResult')||'{}');
 const msg = `Halo! Berikut hasil kuis saya:\nNama: ${data.name}\nAbsen: ${data.nis}\nKelas: ${data.class}\nNilai: ${data.score}\nStatus: ${data.status}`;
 window.open(`https://wa.me/${WA_NUMBER}?text=${encodeURIComponent(msg)}`,'_blank');
});

// Done button
$.btnDone.addEventListener('click', ()=>alert("Terima kasih! Hasil tersimpan di perangkat ini."));
</script>

</body>
</html>
